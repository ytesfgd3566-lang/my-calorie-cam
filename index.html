<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”™è¯¯è¯Šæ–­æ¨¡å¼</title>
    <style>
        body { padding: 20px; font-family: monospace; background: #333; color: #0f0; }
        .container { background: #000; padding: 20px; border: 1px solid #444; }
        input, button { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        input[type="password"] { background: #222; border: 1px solid #555; color: white; }
        input[type="file"] { background: #444; color: white; }
        button { background: #d32f2f; color: white; font-weight: bold; border: none; font-size: 16px; }
        #log-box { white-space: pre-wrap; word-break: break-all; margin-top: 20px; border-top: 1px dashed #666; padding-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h3 style="margin-top:0;">ğŸš‘ æ·±åº¦è¯Šæ–­æ¨¡å¼</h3>
    
    <label>1. API Key:</label>
    <input type="password" id="api-key" placeholder="ç²˜è´´ Key...">

    <label>2. é€‰å›¾:</label>
    <input type="file" id="file-upload" accept="image/*">
    <div id="img-status" style="color: yellow; margin-bottom: 10px;">æœªé€‰å›¾</div>

    <button id="analyze-btn">å¼€å§‹è¯Šæ–­ (æ˜¾ç¤ºçœŸå®æŠ¥é”™)</button>

    <div id="log-box">ç­‰å¾…è¿è¡Œ...</div>
</div>

<script>
    const fileInput = document.getElementById('file-upload');
    const analyzeBtn = document.getElementById('analyze-btn');
    const logBox = document.getElementById('log-box');
    const apiKeyInput = document.getElementById('api-key');
    const imgStatus = document.getElementById('img-status');

    let base64Image = null;
    let mimeType = null;

    // æ—¥å¿—æ‰“å°åŠ©æ‰‹
    function log(msg) {
        logBox.innerHTML += msg + "\n----------------\n";
    }

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            base64Image = e.target.result.split(',')[1];
            mimeType = e.target.result.split(';')[0].split(':')[1];
            imgStatus.innerText = "âœ… å›¾ç‰‡å·²åŠ è½½: " + mimeType;
        }
        reader.readAsDataURL(file);
    });

    analyzeBtn.addEventListener('click', async function() {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) { log("âŒ é”™è¯¯: æœªå¡« API Key"); return; }
        if (!base64Image) { log("âŒ é”™è¯¯: æœªé€‰å›¾ç‰‡"); return; }

        logBox.innerHTML = "ğŸš€ å¼€å§‹å‘ Google å‘é€è¯·æ±‚...\n";
        analyzeBtn.disabled = true;

        // æˆ‘ä»¬åªæµ‹ä¸€ä¸ªæœ€ç¨³çš„æ¨¡å‹ï¼Œçœ‹å®ƒæŠ¥ä»€ä¹ˆé”™
        const modelName = "gemini-1.5-flash"; 
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        try {
            const requestBody = {
                contents: [{
                    parts: [
                        { text: "test" }, // å‘é€æœ€ç®€å•çš„æµ‹è¯•æ–‡æœ¬
                        { inline_data: { mime_type: mimeType, data: base64Image } }
                    ]
                }]
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();

            // â˜…â˜…â˜… å…³é”®ï¼šæ— è®ºæˆåŠŸå¤±è´¥ï¼Œç›´æ¥æŠŠåå°è¿”å›çš„åŸå§‹æ•°æ®æ‰“å°å‡ºæ¥ â˜…â˜…â˜…
            if (!response.ok || data.error) {
                log("âŒ è¯·æ±‚å¤±è´¥ï¼");
                log("çŠ¶æ€ç  (Status): " + response.status);
                log("æŠ¥é”™è¯¦æƒ… (Error Details):\n" + JSON.stringify(data.error, null, 2));
            } else {
                log("âœ… ç¥å¥‡ï¼Œç«Ÿç„¶æˆåŠŸäº†ï¼\n");
                log(data.candidates[0].content.parts[0].text);
            }

        } catch (error) {
            log("âŒ ç½‘ç»œ/ä»£ç å±‚é¢çš„ä¸¥é‡é”™è¯¯:");
            log(error.message);
        } finally {
            analyzeBtn.disabled = false;
        }
    });
</script>

</body>
</html>
