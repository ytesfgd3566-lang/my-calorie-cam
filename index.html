<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡è·¯é‡Œè¯†åˆ« (è‡ªåŠ¨åŒ¹é…ç‰ˆ)</title>
    <style>
        body { padding: 20px; font-family: sans-serif; background-color: #f4f4f9; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        input, button { width: 100%; box-sizing: border-box; margin-bottom: 15px; border-radius: 8px; }
        
        input[type="password"] { padding: 15px; border: 1px solid #ddd; background: #fafafa; }
        
        /* ä¿æŒè¿™ä¸ªä¸‘ä½†å¥½ç”¨çš„åŸç”Ÿä¸Šä¼ æŒ‰é’® */
        input[type="file"] { padding: 10px; background: #e0e0e0; display: block; }

        button { padding: 15px; background-color: #4CAF50; color: white; border: none; font-size: 18px; font-weight: bold; }
        button:disabled { background-color: #ccc; }

        #status-log { font-size: 12px; color: #666; margin-bottom: 10px; font-family: monospace; }
        #result { padding: 15px; background: #e8f5e9; border-radius: 8px; white-space: pre-wrap; display: none; border-left: 5px solid #4CAF50; line-height: 1.6;}
        img { max-width: 100%; margin-top: 10px; border-radius: 8px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; margin-top: 0;">ğŸ¥— å¡è·¯é‡Œè¯†åˆ«</h2>
    
    <input type="password" id="api-key" placeholder="åœ¨æ­¤ç²˜è´´ API Key">

    <label style="font-weight:bold;">æ‹ç…§ / é€‰å›¾ï¼š</label>
    <input type="file" id="file-upload" accept="image/*">
    <img id="preview-img" src="">

    <div id="status-log"></div>

    <button id="analyze-btn">ğŸš€ å¼€å§‹åˆ†æ</button>

    <div id="result"></div>
</div>

<script>
    const fileInput = document.getElementById('file-upload');
    const previewImg = document.getElementById('preview-img');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultDiv = document.getElementById('result');
    const statusLog = document.getElementById('status-log');
    const apiKeyInput = document.getElementById('api-key');

    let base64Image = null;
    let mimeType = null;

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            previewImg.style.display = 'block';
            base64Image = e.target.result.split(',')[1];
            mimeType = e.target.result.split(';')[0].split(':')[1];
            statusLog.innerText = "å›¾ç‰‡å·²å°±ç»ª";
        }
        reader.readAsDataURL(file);
    });

    analyzeBtn.addEventListener('click', async function() {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) { alert("è¯·å¡« Key"); return; }
        if (!base64Image) { alert("è¯·é€‰å›¾"); return; }

        analyzeBtn.disabled = true;
        resultDiv.style.display = 'none';
        
        // â˜…â˜…â˜… æ ¸å¿ƒï¼šè¿™é‡Œåˆ—å‡ºäº†æ‰€æœ‰å¯èƒ½çš„æ¨¡å‹åå­— â˜…â˜…â˜…
        // ç³»ç»Ÿä¼šæŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œç›´åˆ°æˆåŠŸ
        const modelList = [
            "gemini-1.5-flash-001", // å…ˆè¯•å…·ä½“ç‰ˆæœ¬å·
            "gemini-1.5-flash-002", // å†è¯•æ–°ç‰ˆ
            "gemini-1.5-flash",     // å†è¯•ç®€ç§°
            "gemini-1.5-pro",       // æœ€åè¯• Pro ç‰ˆ
            "gemini-1.5-pro-001"
        ];

        let success = false;

        for (const modelName of modelList) {
            statusLog.innerText = `ğŸ”„ æ­£åœ¨å°è¯•è¿æ¥æ¨¡å‹: ${modelName} ...`;
            
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
                
                const requestBody = {
                    contents: [{
                        parts: [
                            { text: "ä½ æ˜¯è¥å…»å¸ˆã€‚è¯·åˆ†æå›¾ç‰‡é£Ÿç‰©ï¼šåç§°ã€çƒ­é‡ã€è¥å…»æˆåˆ†(ç¢³æ°´/è›‹ç™½/è„‚è‚ª)å’Œå»ºè®®ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚" },
                            { inline_data: { mime_type: mimeType, data: base64Image } }
                        ]
                    }]
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.error) {
                    // å¦‚æœæ˜¯â€œæœªæ‰¾åˆ°â€æˆ–â€œä¸æ”¯æŒâ€ï¼Œå°±æŠ›å‡ºé”™è¯¯ï¼Œè®©å¾ªç¯ç»§ç»­è¯•ä¸‹ä¸€ä¸ª
                    throw new Error(data.error.message);
                }

                // å¦‚æœæˆåŠŸäº†ï¼š
                const text = data.candidates[0].content.parts[0].text;
                resultDiv.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
                resultDiv.style.display = 'block';
                statusLog.innerText = `âœ… æˆåŠŸè¿æ¥æ¨¡å‹: ${modelName}`;
                success = true;
                break; // æˆåŠŸäº†å°±è·³å‡ºå¾ªç¯ï¼Œä¸å†è¯•åé¢çš„äº†

            } catch (err) {
                console.log(`${modelName} å¤±è´¥: ${err.message}`);
                // ç»§ç»­è¯•ä¸‹ä¸€ä¸ª...
            }
        }

        if (!success) {
            statusLog.innerText = "âŒ æ‰€æœ‰æ¨¡å‹éƒ½å°è¯•å¤±è´¥ã€‚";
            alert("æ‰€æœ‰æ¨¡å‹éƒ½æ— æ³•è¿æ¥ï¼Œè¯·æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç½‘ç»œæ˜¯å¦é€šç•…ã€‚");
        }

        analyzeBtn.disabled = false;
        analyzeBtn.innerText = "ğŸš€ å¼€å§‹åˆ†æ";
    });
</script>

</body>
</html>
